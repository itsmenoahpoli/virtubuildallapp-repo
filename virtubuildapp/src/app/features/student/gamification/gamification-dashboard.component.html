<div class="gamification-dashboard">
  <div class="dashboard-header">
    <h1>Gamification Dashboard</h1>
    <p>Track your progress, achievements, and compete with others!</p>
  </div>

  <div class="dashboard-content" *ngIf="!loading">
    <!-- My Progress Section -->
    <div class="my-progress-section">
      <div class="progress-card">
        <h2>My Progress</h2>
        <div class="progress-stats">
          <div class="stat-item">
            <div class="stat-icon">‚≠ê</div>
            <div class="stat-content">
              <h3>{{ gamificationData.totalPoints || 0 }}</h3>
              <p>Total Points</p>
            </div>
          </div>
          <div class="stat-item">
            <div class="stat-icon">üèÜ</div>
            <div class="stat-content">
              <h3>{{ gamificationData.level || 0 }}</h3>
              <p>Current Level</p>
            </div>
          </div>
          <div class="stat-item">
            <div class="stat-icon">üî•</div>
            <div class="stat-content">
              <h3>{{ gamificationData.streak || 0 }}</h3>
              <p>Day Streak</p>
            </div>
          </div>
          <div class="stat-item">
            <div class="stat-icon">‚úÖ</div>
            <div class="stat-content">
              <h3>{{ gamificationData.activitiesCompleted || 0 }}</h3>
              <p>Activities Completed</p>
            </div>
          </div>
        </div>

        <!-- Level Progress Bar -->
        <div class="level-progress">
          <div class="level-info">
            <span class="current-level">Level {{ gamificationData.level || 0 }}</span>
            <span class="next-level">Level {{ (gamificationData.level || 0) + 1 }}</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="getLevelProgress()"></div>
          </div>
          <div class="progress-text">
            {{ gamificationData.totalPoints || 0 }} / {{ getNextLevelPoints() }} points
          </div>
        </div>
      </div>
    </div>

    <!-- Badges and Achievements -->
    <div class="achievements-section">
      <div class="achievements-card">
        <h2>Badges & Achievements</h2>
        <div class="badges-grid" *ngIf="gamificationData.badges && gamificationData.badges.length > 0">
          <div class="badge-item" *ngFor="let badge of gamificationData.badges">
            <div class="badge-icon">{{ badge.icon || 'üèÖ' }}</div>
            <div class="badge-info">
              <h4>{{ badge.name }}</h4>
              <p>{{ badge.description }}</p>
              <span class="badge-date">{{ badge.earnedDate | date:'short' }}</span>
            </div>
          </div>
        </div>
        <div class="no-badges" *ngIf="!gamificationData.badges || gamificationData.badges.length === 0">
          <p>No badges earned yet. Complete activities to earn your first badge!</p>
          <button class="btn btn-primary" (click)="checkAchievements()">
            Check for New Achievements
          </button>
        </div>
      </div>
    </div>

    <!-- Leaderboard -->
    <div class="leaderboard-section">
      <div class="leaderboard-card">
        <h2>Global Leaderboard</h2>
        <div class="leaderboard-list">
          <div class="leaderboard-item" 
               *ngFor="let player of leaderboard; let i = index"
               [class.my-rank]="i === myRank - 1">
            <div class="rank">{{ i + 1 }}</div>
            <div class="player-info">
              <div class="player-name">{{ player.firstName }} {{ player.lastName }}</div>
              <div class="player-stats">
                <span class="points">{{ player.totalPoints }} pts</span>
                <span class="level">Level {{ player.level }}</span>
              </div>
            </div>
            <div class="player-badges">
              <span class="badge-count">{{ player.badges?.length || 0 }} badges</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Top Performers -->
    <div class="top-performers-section">
      <div class="top-performers-card">
        <h2>Top Performers This Week</h2>
        <div class="performers-list">
          <div class="performer-item" *ngFor="let performer of topPerformers; let i = index">
            <div class="performer-rank">{{ i + 1 }}</div>
            <div class="performer-info">
              <div class="performer-name">{{ performer.firstName }} {{ performer.lastName }}</div>
              <div class="performer-achievement">{{ performer.achievement }}</div>
            </div>
            <div class="performer-score">{{ performer.score }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="loading-spinner" *ngIf="loading">
    <div class="spinner"></div>
    <p>Loading gamification data...</p>
  </div>
</div>
